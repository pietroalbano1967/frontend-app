<div class="container">
    <h2>Predizioni Borsa Italiana</h2>

    <div class="controls">
        <!-- Correggi questa linea: passa l'evento $event -->
        <select [ngModel]="selectedTicker" (ngModelChange)="onTickerChange($event)">
            @for (ticker of tickers; track ticker.symbol) {
            <option [value]="ticker.symbol">
                {{ticker.name}} ({{ticker.symbol}})
            </option>
            }
        </select>

        <button (click)="predict()" [disabled]="isLoading">
            @if (isLoading) {
            Caricamento...
            } @else {
            Genera Predizione
            }
        </button>
    </div>

    @if (prediction) {
    <div class="prediction-info">
        <h3>Predizioni per i prossimi {{prediction.predicted.length}} giorni</h3>
        <p>Confidenza: {{prediction.confidence * 100 | number:'1.0-0'}}%</p>
    </div>
    }

    <div class="chart-container">
        <canvas id="stock-chart"></canvas>
    </div>

    @if (stockData.length) {
    <div class="data-table">
        <h3>Ultimi 10 giorni</h3>
        <table>
            <tr>
                <th>Data</th>
                <th>Apertura</th>
                <th>Chiusura</th>
                <th>Variazione</th>
            </tr>
            @for (day of stockData.slice(-10); track day.date) {
            <tr>
                <td>{{day.date}}</td>
                <td>{{day.open | currency:'EUR'}}</td>
                <td>{{day.close | currency:'EUR'}}</td>
                <td [class]="day.close > day.open ? 'positive' : 'negative'">
                    {{((day.close - day.open) / day.open * 100) | number:'1.2-2'}}%
                </td>
            </tr>
            }
        </table>
    </div>
    }
</div>