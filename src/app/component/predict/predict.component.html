<div class="container">
    <h2>Predizioni Borsa Italiana</h2>

    <div class="controls">
        <select [ngModel]="selectedTicker" (ngModelChange)="onTickerChange($event)">
            @for (ticker of tickers; track ticker.symbol) {
            <option [value]="ticker.symbol">
                {{ticker.name}} ({{ticker.symbol}})
            </option>
            }
        </select>

        <button (click)="predict()" [disabled]="isLoading">
            {{isLoading ? 'Caricamento...' : 'Genera Predizione'}}
        </button>

        <!-- Aggiungi controlli zoom per il grafico -->
        <div class="zoom-controls" *ngIf="chart">
            <button (click)="zoomIn()" title="Zoom In">+</button>
            <button (click)="zoomOut()" title="Zoom Out">-</button>
            <button (click)="resetZoom()" title="Reset Zoom">‚ü≥</button>
        </div>
    </div>

    @if (prediction) {
    <div class="prediction-info">
        <h3>Predizioni per i prossimi {{prediction.predicted.length}} giorni</h3>
        <p>Confidenza: {{prediction.confidence * 100 | number:'1.0-0'}}%</p>
    </div>
    }

    <!-- Container del grafico con overflow per lo zoom -->
    <div class="chart-zoom-container">
        <div class="chart-container" #chartContainer>
            <canvas id="stock-chart"></canvas>
        </div>
    </div>

    @if (stockData.length) {
    <div class="data-table">
        <h3>Ultimi 10 giorni</h3>
        <table>
            <tr>
                <th>Data</th>
                <th>Apertura</th>
                <th>Chiusura</th>
                <th>Variazione</th>
            </tr>
            @for (day of stockData.slice(-10); track day.date) {
            <tr>
                <td>{{day.date}}</td>
                <td>{{day.open | currency:'EUR'}}</td>
                <td>{{day.close | currency:'EUR'}}</td>
                <td [class]="day.close > day.open ? 'positive' : 'negative'">
                    {{((day.close - day.open) / day.open * 100) | number:'1.2-2'}}%
                </td>
            </tr>
            }
        </table>
    </div>
    }
</div>